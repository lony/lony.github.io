
<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="Goetz Epperlein">
<meta name="keywords" content="programming,cli,linux,commands">
<meta property="og:title" content="CLI commands - [x]">
<meta property="og:description" content="CLI commands">
<title>CLI commands | [x]</title>

<link rel="stylesheet" href="https://lony.github.io//css/style.css">
<link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">

<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/styles/github.min.css">


<section class="section">
  <div class="container">
    <nav class="nav">
      <div class="nav-left">
        <a class="nav-item" href="https://lony.github.io/"><h1 class="title is-4">[x]</h1></a>
      </div>
      <div class="nav-right">
        <nav class="nav-item level is-mobile">
          
          <a class="level-item" href="https://github.com/lony">
            <span class="icon">
              <i class="fa fa-github"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://www.xing.com/profile/Goetz_Epperlein">
            <span class="icon">
              <i class="fa fa-xing"></i>
            </span>
          </a>
          
          <a class="level-item" href="https://de.linkedin.com/in/goetzepperlein">
            <span class="icon">
              <i class="fa fa-linkedin"></i>
            </span>
          </a>
          
          <a class="level-item" href="/index.xml">
            <span class="icon">
              <i class="fa fa-rss"></i>
            </span>
          </a>
          
        </nav>
      </div>
    </nav>
  </div>
</section>

<section class="section">
  <div class="container">
    <h2 class="subtitle is-6">February 25, 2017</h2>
    <h1 class="title">CLI commands</h1>
    
      <div class="tags">
    
        <a class="button is-link" href="/tags/programming">programming</a>
    
        <a class="button is-link" href="/tags/cli">cli</a>
    
        <a class="button is-link" href="/tags/linux">linux</a>
    
        <a class="button is-link" href="/tags/commands">commands</a>
    
</div>

    
    <div class="content">
      

<p>Working with UNIX systems you often need commands to get something done. This is a continuously updated collection of useful commands I compile and maintain for myself - and maybe also for <code>you</code>.</p>

<p>The collection is divided into different sections under which the commands are explained. For each commands there are examples how to use them, as links - from which information about the command can be gathered. For the most commands there is also a short explanation what it does.</p>

<p>If you find a bug or want to recommend something, please feel free to open an <a href="https://github.com/lony/lony.github.io/issues">issue</a> and help me get better. - Thank you!</p>

<h1 id="toc">TOC</h1>

<ul>
<li><a href="#file-system">File system</a>

<ul>
<li><a href="#configuration-management">Configuration management</a>

<ul>
<li><a href="#ansible">Ansible</a></li>
<li><a href="#chef">Chef</a></li>
</ul></li>
<li><a href="#package-management">Package management</a></li>
</ul></li>
<li><a href="#processes">Processes</a>

<ul>
<li><a href="#docker">Docker</a></li>
<li><a href="#vagrant">Vagrant</a></li>
<li><a href="#virtualbox">VirtualBox</a></li>
</ul></li>
<li><a href="#user-environment">User environment</a></li>
<li><a href="#text-processing">Text processing</a></li>
<li><a href="#shell-bulletins">Shell bulletins</a></li>
<li><a href="#networking">Networking</a></li>
<li><a href="#searching">Searching</a></li>
<li><a href="#documentation">Documentation</a></li>
<li><a href="#miscellaneous">Miscellaneous</a>

<ul>
<li><a href="#programming-sh">Programming sh</a>

<ul>
<li><a href="#array">array</a></li>
<li><a href="#for">for</a></li>
<li><a href="#if">if</a></li>
<li><a href="#until">until</a></li>
<li><a href="#pasting">pasting</a></li>
<li><a href="#pipe">pipe</a></li>
<li><a href="#read">read</a><br /></li>
</ul></li>
<li><a href="#setup">Setup</a>

<ul>
<li><a href="#prompt">Prompt</a></li>
<li><a href="#distribution">Distribution</a></li>
</ul></li>
</ul></li>
<li><a href="#meta">Meta</a></li>
</ul>

<hr />

<h1 id="file-system">File system</h1>

<ul>
<li><p>cat</p>

<ul>
<li><code>cat /etc/issue</code> - Show ubuntu system version</li>
</ul></li>

<li><p>ls</p>

<ul>
<li><code>ls -R</code> - Recursive list of directory and files within</li>
<li><code>ls='ls -Fh -G'</code></li>
<li><code>l='ls -1A'</code></li>
<li><code>ll='ls -lh'</code></li>
</ul></li>

<li><p>ln - Link files <a href="http://stackoverflow.com/questions/9587445/how-to-create-a-link-to-a-directory">1</a></p>

<ul>
<li><code>ln -s /foo/bar /home/lony/bar</code> - Creates symbolic link</li>
<li><code>ln /foo/bar /home/lony/bar</code> - Creates hard link (files only)
<br /></li>
</ul></li>

<li><p>mkfifo - Create named pipe</p>

<pre><code>mkfifo in 
ssh -A -l LOGIN BASTIAN_HOST nc TARGET_HOST TARGET_PORT &lt;in | nc -l LOCAL_PORT &gt;in
rm in
</code></pre></li>

<li><p>openssl <a href="http://snazzylabs.com/tutorial/five-advanced-tricks-for-mac-users/">1</a>, <a href="http://www.czeskis.com/random/openssl-encrypt-file.html">2</a>, <a href="https://www.digitalocean.com/community/tutorials/openssl-essentials-working-with-ssl-certificates-private-keys-and-csrs">3</a> - SSL encryption library</p>

<ul>
<li><code>openssl enc -aes-256-cbc -e -in {path-in} -out {path-out}</code> - Encrypt file with password (aes-256)</li>
<li><code>openssl enc -aes-256-cbc -d -in {path-in} -out {path-out}</code> - Decrypt file with password (aes-256)</li>
<li><code>openssl rsa -des3 -in {path-in} -out {path-out}</code> - Encrypt key with password (rsa)</li>
<li><code>openssl rsa -in {path-in} -out {path-out}</code> - Decrypt key with password (rsa)</li>
<li><code>echo | openssl s_client -host IP_OF_TARGET -port 443 2&gt;&amp;1 | openssl x509 -noout -subject</code> - Get SSL certificate subject of target machine</li>
</ul></li>

<li><p>rsync <a href="https://en.wikipedia.org/wiki/Rsync">1</a>, <a href="http://stackoverflow.com/questions/4493525/rsync-what-means-the-f-on-rsync-logs">2</a> - Data synchronization tool</p>

<ul>
<li><p><code>rsync -rlptzvn rsync://USER@foo.bar.de/home/lony_src/ /home/lony_dest/</code> - Synchronize data from source to destination preserving source and not deleting anything</p>

<ul>
<li><code>-r</code> - Recurs into folders</li>
<li><code>-l</code> - Copy also symlinks</li>
<li><code>-p</code> - Preserve permissions</li>
<li><code>-t</code> - Preserve modification times</li>
<li><code>-z</code> - Compress during transfer</li>
<li><code>-v</code> - Verbosity ++</li>
<li><code>-n</code> or <code>--dry-run</code> - Perform trial run</li>
</ul></li>

<li><p><code>rsync -aivh --progress --delete source/ dest/</code> <a href="http://askubuntu.com/questions/476041/how-do-i-make-rsync-delete-files-that-have-been-deleted-from-the-source-folder">1</a> - Synchronize files and even delete irrelevant files on destination</p>

<ul>
<li><code>-a</code> - Archive mode; equals <code>-rlptgoD</code></li>
<li><code>-g</code> - Preserve group</li>
<li><code>-o</code> - Preserve owner</li>
<li><code>-D</code> - Preserve devices and special files</li>
<li><code>-h</code> - Numbers in human-readable format</li>
<li><code>-i</code> <a href="http://serverfault.com/questions/618735/can-i-use-rsync-to-create-a-list-of-only-changed-files">1</a> - Change summary for all updates</li>
<li><code>--progress</code> - Show progress of transfer</li>
<li><code>--delete</code> - Deletes irrelevant files from destination</li>
</ul></li>

<li><p><code>rsync -rlptzvhn --progress --remove-source-files --prune-empty-dirs --ignore-errors source/ dest/</code> <a href="https://superuser.com/questions/676671/rsync-does-not-delete-source-directories">1</a>, <a href="http://unix.stackexchange.com/questions/78375/move-files-and-delete-directories-with-rsync">2</a>, <a href="http://serverfault.com/questions/598662/copy-directory-tree-without-empty-directories">3</a> - Copy files from source to destination deleting them at the source afterwards (empty folders will be kept)</p>

<ul>
<li><code>--remove-source-files</code> - Remove synchronized files from source</li>
<li><code>--prune-empty-dirs</code> - Ignore empty directories for transfer</li>
<li><code>--ignore-errors</code> - Ignore errors
<br /></li>
</ul></li>

<li><p><code>rsync -vzi -e ssh server:source/ dest/</code> <a href="https://kyup.com/tutorials/copy-files-rsync-ssh/">1</a> - Use rsync via ssh</p></li>
</ul></li>

<li><p>tar</p>

<ul>
<li><p><code>tar cvzf - 2017-02-11_T430s_Windows8.tib | split -b 4294967295 -  ../win-bu.tar.gz.</code> <a href="http://unix.stackexchange.com/questions/61774/create-a-tar-archive-split-into-blocks-of-a-maximum-size">1</a> - Create gzip tar archiv in multiple chunks</p></li>

<li><p><code>cat win-bu.tar.gz.aa win-bu.tar.gz.ab &gt; combined.tar.gz \
gunzip combined.tar.gz \
tar -xvf combined.tar</code> <a href="http://stackoverflow.com/questions/27491606/how-to-create-a-linux-compatible-zip-archive-of-a-directory-on-a-mac">1</a> - Unzip multi-chunk gunziped tar archive</p></li>
</ul></li>

<li><p>virtualenv - Virtual environments for python</p>

<ul>
<li><code>virtualenv -p /usr/bin/python2.7 venv --no-site-packages</code> - Create a virtual python2.7 environment inside <em>venv</em></li>
</ul></li>

<li><p>zip</p>

<ul>
<li><code>zip -r &lt;TARGET_.zip&gt; &lt;SOURCE_FOLDER&gt;/</code> <a href="http://unix.stackexchange.com/questions/57013/zip-all-files-in-directory">1</a> - Zip folder recursively</li>
<li><code>zip -r -s 3g archive.zip FolderName/</code> <a href="http://www.addictivetips.com/mac-os/how-to-create-a-split-zipped-archive-from-mac-os-x-terminal/">1</a> - Split into multiple chunks</li>
</ul></li>
</ul>

<h2 id="configuration-management">Configuration management</h2>

<h3 id="ansible">Ansible</h3>

<ul>
<li><p>ansible-playbook - Runs Ansible playbooks</p>

<ul>
<li><code>ansible-playbook site.yml -i localhost, --connection=local</code></li>
</ul></li>
</ul>

<h3 id="chef">Chef</h3>

<ul>
<li><p>chef-client</p>

<ul>
<li><code>chef-client -W</code> - Test run without actually changing anything</li>
</ul></li>

<li><p>chef-server-ctl</p>

<ul>
<li><code>chef-server-ctl org-user-add -a &lt;ORGA&gt; &lt;USER&gt;</code> - Create user in organization using chef ACL</li>
</ul></li>

<li><p>knife</p>

<ul>
<li><code>knife node list</code> - Show systems</li>
<li><code>knife node from file nodes/&lt;MASCHINE_NAME&gt;.rb</code> - Loads local node configuration to Chef server</li>
<li><code>knife data bag list</code></li>
<li><code>knife data bag show &lt;DATA_BAG_FOLDer&gt; &lt;DATA_BAG_FILE&gt; --format=json</code></li>

<li><p><code>knife data bag show &lt;DATA_BAG_FOLDer&gt; &lt;DATA_BAG_FILE&gt; -z --secret-file &lt;SYMMETRIC_SECRET_KEY&gt; -Fjson</code> - Shows locally stored encrypted data bag</p>

<ul>
<li><code>-z</code> - Local chef mode, uses local files

<ul>
<li>HINT: Needs chef-repo structure as on the server</li>
</ul></li>
<li><code>--secret-file</code> - Specifies symmetric key used to encrypted and decrypted</li>
<li><code>-Fjson</code> same as <code>--format=jso</code> - Output data as JSON</li>
</ul></li>

<li><p><code>knife vault list</code></p></li>

<li><p><code>knife vault show &lt;DATA_BAG_FOLDer&gt; &lt;DATA_BAG_FILE&gt;</code></p></li>

<li><p><code>knife cookbook download -s &quot;https://&lt;SERVER_URL&gt;&quot; &lt;COOKBOOK_NAME&gt; 0.3.0</code></p></li>
</ul></li>

<li><p>kitchen</p>

<ul>
<li><code>kitchen create</code> - Create instance/container using provisioner</li>
<li><code>kitchen converge</code> - Runs chef on the instance/container</li>
<li><code>kitchen verify</code> -  Runs tests on the instance/container</li>
<li><code>kitchen test</code> - Does all togehter and at the end drops container</li>
<li><code>kitchen login</code> - Opens shell into instance/container</li>
<li><code>kitchen list</code> - Lists instance/container</li>
</ul></li>
</ul>

<h2 id="package-management">Package management</h2>

<ul>
<li><p>apt <a href="http://askubuntu.com/questions/705885/difference-between-dpkg-i-and-apt-get-install">1</a>, <a href="http://askubuntu.com/questions/309113/what-is-the-difference-between-dpkg-and-aptitude-apt-get">2</a> - Debian/Ubuntu package manager (including dependencies)</p>

<ul>
<li><code>apt-get update</code> -  Update is used to re-synchronize the package index files from their sources via Internet</li>
<li><code>apt-get upgrade</code> - Upgrade is used to install the newest versions of all packages currently installed on the system</li>
<li><code>apt-get install --only-upgrade linux-generic</code></li>
<li><code>apt-get autoremove --purge</code></li>
<li><code>apt-get upgrade --dry-run</code> <a href="http://askubuntu.com/questions/99834/how-do-you-see-what-packages-are-available-for-update">1</a></li>
<li><code>apt-get dist-upgrade</code> <a href="https://www.cyberciti.biz/faq/how-do-i-update-ubuntu-linux-software">1</a> - Update newer version of distribution</li>
</ul></li>

<li><p>aptitude <a href="http://unix.stackexchange.com/questions/767/what-is-the-real-difference-between-apt-get-and-aptitude-how-about-wajig">1</a> - cli GUI for package management</p></li>

<li><p>dpkg - Debian/Ubuntu package manager (without dependencies)</p>

<ul>
<li><code>dpkg -l</code></li>
</ul></li>

<li><p>pip - Python package manager</p>

<ul>
<li><code>pip install ansible</code> - Install package</li>
<li><code>pip install -r requirements.txt</code> - Install all packages listed in requirements.txt</li>
</ul></li>

<li><p><code>sudo update-alternatives --config java</code> - Set default Java version on system</p></li>
</ul>

<h2 id="version-control-systems-https-en-wikipedia-org-wiki-version-control-vcs"><a href="https://en.wikipedia.org/wiki/Version_control">Version control systems</a> (VCS)</h2>

<ul>
<li><p>git <a href="https://git-scm.com/">1</a> - Distributed VCS</p>

<ul>
<li><code>git update-index --assume-unchanged FILE_NAME</code> <a href="http://stackoverflow.com/questions/9794931/keep-file-in-a-git-repo-but-dont-track-changes">1</a> - Ignore file for comparison (HINT: only set locally on repository)</li>
<li><code>git update-index --no-assume-unchanged FILE_NAME</code> - Regard file again for comparison</li>
</ul></li>
</ul>

<h1 id="processes">Processes</h1>

<ul>
<li><p>atop <a href="http://www.tecmint.com/how-to-install-atop-to-monitor-logging-activity-of-linux-system-processes/">1</a> - System &amp; Process Monitor like top or htop</p></li>

<li><p>df - Display free disk space</p>

<ul>
<li><code>df -h</code></li>
</ul></li>

<li><p>du</p>

<ul>
<li><code>du -h --max-depth=1 /</code></li>
<li><code>du -a /var | sort -n -r | head -n 10</code> <a href="https://www.cyberciti.biz/faq/how-do-i-find-the-largest-filesdirectories-on-a-linuxunixbsd-filesystem/">1</a> - List 10 biggest folders or files in /var</li>
</ul></li>

<li><p>glances <a href="https://nicolargo.github.io/glances/">1</a> - A top/htop alternative</p></li>

<li><p>htop <a href="https://codeahoy.com/2017/01/20/hhtop-explained-visually">1</a> - Interactive process monitor</p></li>

<li><p>iotop <a href="http://guichaz.free.fr/iotop/">1</a>, <a href="http://www.tecmint.com/iotop-monitor-linux-disk-io-activity-per-process/">2</a> - System I/O monitor like top</p></li>

<li><p><code>sudo initctl restart apache</code> <a href="https://wiki.ubuntu.com/SystemdForUpstartUsers">1</a>,<a href="http://upstart.ubuntu.com/">2</a> - Restart command for upstart (using /etc/init)</p></li>

<li><p>lsof <a href="https://en.wikipedia.org/wiki/Lsof">1</a> - list of open files</p>

<ul>
<li><code>sudo lsof -i</code> - All internal network files</li>
<li><code>sudo lsof | grep jre</code></li>
<li><code>sudo lsof -i -n -P | grep LISTEN</code></li>
</ul></li>

<li><p>ps <a href="https://en.wikipedia.org/w/index.php?oldid=765270359">1</a> - Static process monitor</p></li>

<li><p>screen <a href="https://en.wikipedia.org/wiki/GNU_Screen">1</a> - terminal multiplexer</p>

<ul>
<li><p><code>screen &lt;COMMAND&gt;</code> - Start command in screen session</p>

<ul>
<li>Press (Strg + a + d) - Detach running session <a href="https://nathan.chantrell.net/linux/an-introduction-to-screen/">1</a></li>
</ul></li>

<li><p><code>screen -ls</code> - List screen sessions</p></li>

<li><p><code>screen -r</code> - Resume last running screen session</p></li>

<li><p><code>screen -r -d 30608</code> - Resume already attached session <a href="http://unix.stackexchange.com/questions/240444/cant-resume-screen-says-i-am-already-attached">1</a></p></li>

<li><p><code>screen -dmS &lt;SESSION_NAME&gt; &lt;COMMAND&gt;</code> - Starts screen in detached mode using the given session name and command</p></li>
</ul></li>

<li><p><code>sudo service apache restart</code> - Restart command for System V (using /etc/init.d)</p></li>

<li><p>top <a href="https://en.wikipedia.org/w/index.php?oldid=758781701">1</a> - Real-time task manager</p></li>

<li><p>tree <a href="https://en.wikipedia.org/w/index.php?oldid=766877590">1</a> - Recursive directory listing program</p>

<ul>
<li><code>tree -d -L 2</code></li>
</ul></li>
</ul>

<h2 id="docker">Docker</h2>

<ul>
<li><code>docker pull jenkins:2.32.1</code> - Download docker image from registry</li>
<li><code>docker build</code> - Build an image from a Dockerfile</li>
<li><code>docker run -p 8080:8080 jenkins:2.32.1</code> - Starts existing docker image and maps port</li>
<li><code>docker run -it -d shykes/pybuilder /bin/bash</code> <a href="http://stackoverflow.com/questions/26153686/how-to-run-a-command-on-an-already-existing-docker-container">1</a> - Run image and start bash</li>
<li><code>docker exec -it f151aff2b21e /bin/bash</code> - Starts docker image f151aff2b21e and open interactive shell</li>
<li><code>docker ps -a</code> - List instances (derived from images)</li>
<li><code>docker rm -f 2247780d0b39</code> - Delete instance</li>
<li><code>docker images</code> - List images</li>
<li><code>docker rmi ae12afb99714 a78344b99ebc</code> - Delete images</li>
</ul>

<h2 id="vagrant">Vagrant</h2>

<ul>
<li><p><code>vagrant global-status</code> - Show existing VMs</p>

<ul>
<li><code>vagrant global-status --prune</code> - <a href="http://stackoverflow.com/questions/24611902/remove-vagrant-box-from-global-status-after-deleting-it-from-filesystem">1</a> Update vagrant cache</li>
</ul></li>

<li><p><code>vagrant up</code> - Create VM from scratch</p>

<ul>
<li><code>export VAGRANT_LOG=debug; vagrant up</code> - Change vagrant log level</li>
</ul></li>

<li><p><code>vagrant provision</code> - Create VM using existing Vagrantfile</p></li>

<li><p><code>vagrant destroy -f 1f7d3b6</code>  - Delete VM</p>

<ul>
<li><code>vagrant destroy -f</code> - Destroy without confirmation</li>
</ul></li>

<li><p><code>vagrant ssh</code> - SSH into the VM</p>

<ul>
<li><code>vagrant ssh-config &lt;NAME_OR_ID_OF_VM&gt; | awk -v ORS=' ' '{print &quot;-o &quot; $1 &quot;=&quot; $2}'</code> - Get parameter to scp into VM</li>
</ul></li>

<li><p><code>vagrant plugin list</code> - Show vagrant plugins</p></li>

<li><p><code>vagrant plugin install vagrant-vbguest vagrant-cachier vagrant-share vagrant-triggers</code> - Install vagrant plugins</p></li>
</ul>

<h2 id="virtualbox">VirtualBox</h2>

<ul>
<li><p><code>VBoxManage list runningvms | awk '{print $2;}' | xargs -I {} VBoxManage controlvm {} poweroff</code> - <a href="http://stackoverflow.com/questions/15408969/how-do-i-destroy-a-vm-when-i-deleted-the-vagrant-file">1</a> Halt all running virtual boxes</p></li>

<li><p><code>VBoxManage list vms | awk '{print $2;}' | xargs -I {} VBoxManage unregistervm {}</code> - Clean ALL virtual boxes</p></li>

<li><p><code>VBoxManage setproperty machinefolder ${BASE_TMP_FOLDER}</code> - <a href="http://superuser.com/questions/599421/how-to-move-the-default-folder-for-headless-virtualbox">1</a> Switch vagrant box folder</p></li>
</ul>

<h1 id="user-environment">User environment</h1>

<ul>
<li><p><code>ldapsearch -H ldap://&lt;SERVER_URL&gt; -w &lt;PASSWORD&gt; -D cn=readonly,dc=lony &quot;(&amp;(objectClass=user)(cn=prod))&quot;</code> - Command to query LDAP server</p></li>

<li><p><code>shutdown -rf now</code></p></li>

<li><p>who <a href="https://en.wikipedia.org/w/index.php?oldid=731053985">1</a> - Display users logged in</p>

<ul>
<li><code>who -r</code> - Show runlevel</li>
</ul></li>
</ul>

<h1 id="text-processing">Text processing</h1>

<ul>
<li>jq <a href="https://stedolan.github.io/jq/">1</a> - CLI JSON processor</li>
<li>xargs <a href="https://www.cyberciti.biz/faq/linux-unix-bsd-xargs-construct-argument-lists-utility/">1</a> - Sub-list generator</li>
</ul>

<h1 id="shell-bulletins">Shell bulletins</h1>

<h1 id="networking">Networking</h1>

<ul>
<li><p>curl - Client for URLs</p>

<ul>
<li><code>curl -X POST -H &quot;Content-Type: application/json&quot; -H &quot;Cache-Control: no-cache&quot; -d '{ &quot;username&quot; : &quot;xxx&quot;, &quot;pw&quot; : &quot;xxx&quot;}' &quot;http://localhost:8080/user/authenticate&quot;</code></li>
</ul></li>

<li><p>dig - DNS querying tool using OS resolver</p>

<ul>
<li><code>dig +short myip.opendns.com @resolver1.opendns.com</code> <a href="http://unix.stackexchange.com/questions/22615/how-can-i-get-my-external-ip-address-in-a-shell-script">1</a> - Retrieve your external IP address using DNS</li>
</ul></li>

<li><p>httpie <a href="https://httpie.org/">1</a>,<a href="https://github.com/jkbrzt/httpie">2</a> - Better curl with JSON support</p></li>

<li><p>ifconfig <a href="https://en.wikipedia.org/wiki/Ifconfig">1</a> - Display network interface configuration for Unix-systems</p></li>

<li><p>ipcalc <a href="https://pypi.python.org/pypi/ipcalc">1</a> - IP subnet calculator</p></li>

<li><p>iptables <a href="https://en.wikipedia.org/wiki/Iptables">1</a>, <a href="https://manpages.debian.org/jessie/iptables/iptables.8.en.html">2</a>, <a href="https://wiki.archlinux.org/index.php/iptables">3</a> - IPv4 firewall interface for Linux</p>

<ul>
<li><p>Overview of packet traversing (or <a href="http://jekor.com/gressgraph/">graph</a> your own), Source: <a href="/img/2017/commands/iptables.ep">Pencil file</a>
<img src="/img/2017/commands/iptables.png" alt="iptables overview" /></p></li>

<li><p><code>iptables -nvL</code> <a href="https://www.digitalocean.com/community/tutorials/how-to-list-and-delete-iptables-firewall-rules">1</a> - Show existing rules</p>

<ul>
<li><code>-n</code> - Numeric output, do not resolve host names</li>
<li><code>-v</code> - Verbose output</li>
<li><code>-L [CHAIN]</code> - List all rules in optional chain</li>
</ul></li>

<li><p><code>iptables -F</code> or <code>iptables --flush</code> - Delete all existing rules</p></li>

<li><p><code>iptables -P OUTPUT DROP</code> - DROP all outgoing traffic</p>

<ul>
<li><code>-P CHAIN TARGET</code> - Set policy for chain to given target (e.g. ACCEPT, REJECT, DROP or RETURN)</li>
</ul></li>

<li><p><code>iptables -A OUTPUT -d 192.30.0.0/17 -j DROP</code> - Drop only outgoing traffic to specified subnet</p>

<ul>
<li><code>-A OUTPUT</code> - Append rule to OUTPUT chain</li>
<li><code>-d DEST</code> - Destination e.g. address, hostname, network name</li>
<li><code>-j TARGET</code> - Specifies target of rule; i.e. what to do if packet matches.</li>
</ul></li>

<li><p><code>iptables -A OUTPUT -s 192.20.0.1 -j DROP</code> <a href="https://www.linode.com/docs/security/firewalls/control-network-traffic-with-iptables">1</a> - Drop outgoing traffic only to specified IP address</p>

<ul>
<li><code>-s SRC</code> - Source e.g. address, hostname, network name</li>
</ul></li>

<li><p><code>iptables -A INPUT -p tcp --dport 80 -m limit --limit 25/minute --limit-burst 100 -j ACCEPT</code> <a href="https://crm.vpscheap.net/knowledgebase.php?action=displayarticle&amp;id=29">1</a> - Prevent DoS Attack</p>

<ul>
<li><code>-m limit</code> - Use limit iptables extension</li>
<li><code>–limit 25/minute</code> - Limit to only 25 connections per minute</li>
<li><code>–limit-burst 100</code> - The limit per minute will only be enforced if the total number of connections have reached this burst limit</li>
</ul></li>

<li><p>Allow incoming SSH connections only from specified subnet</p>

<pre><code>iptables -A INPUT -i eth0 -p tcp -s 192.168.100.0/24 --dport 22 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp --sport 22 -m state --state ESTABLISHED -j ACCEPT
</code></pre></li>

<li><p>Combine rules using multiport</p>

<pre><code>iptables -A INPUT -i eth0 -p tcp -m multiport --dports 22,80,443 -m state --state NEW,ESTABLISHED -j ACCEPT
iptables -A OUTPUT -o eth0 -p tcp -m multiport --sports 22,80,443 -m state --state ESTABLISHED -j ACCEPT
</code></pre></li>

<li><p>Load balance incoming traffic</p>

<pre><code>iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 0 -j DNAT --to-destination 192.168.1.101:443
iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 1 -j DNAT --to-destination 192.168.1.102:443
iptables -A PREROUTING -i eth0 -p tcp --dport 443 -m state --state NEW -m nth --counter 0 --every 3 --packet 2 -j DNAT --to-destination 192.168.1.103:443
</code></pre></li>
</ul></li>

<li><p>iptraf <a href="http://unix.stackexchange.com/questions/71456/check-outgoing-network-traffic">1</a> - Network statistic tool</p></li>

<li><p>netcat aka nc - Tool to read and write from network connections</p>

<ul>
<li><code>nc -vz external.host 6379</code> - Just test Redis port with verbose output</li>
<li><code>netcat -vv localhost 3306</code></li>
</ul></li>

<li><p>netstat - Host based network statistic tool</p>

<ul>
<li><code>sudo netstat -tulpn | grep LISTEN</code></li>
<li><code>sudo netstat -an | grep 8080 | grep ESTABLISHED</code></li>
</ul></li>

<li><p>ngrep <a href="https://en.wikipedia.org/wiki/Ngrep">1</a> - Similar to tcpdump</p></li>

<li><p>nmap <a href="https://www.digitalocean.com/community/tutorials/how-to-test-your-firewall-configuration-with-nmap-and-tcpdump">1</a> - Network mapping and port scanning tool</p></li>

<li><p><code>nscd -i hosts</code> <a href="http://serverfault.com/questions/16299/how-do-i-flush-the-dns-cache-on-win-mac-linux-computers">1</a> - Flush DNS cache</p></li>

<li><p>nslookup <a href="https://en.wikipedia.org/wiki/Nslookup">1</a>,<a href="http://unix.stackexchange.com/questions/93808/dig-vs-nslookup">2</a> - DNS querying tool incl. own resolver</p></li>

<li><p>ntop <a href="https://en.wikipedia.org/wiki/Ntop">1</a> - Interactive network monitor</p></li>

<li><p>ntpdate</p>

<ul>
<li><code>ntpdate -q de.pool.ntp.org</code> - Query NTP service without changing something</li>
</ul></li>

<li><p>route <a href="https://en.wikipedia.org/w/index.php?oldid=749414632">1</a> - View IP routing table of host (replaced with <code>iproute2</code>)</p></li>

<li><p>scp - secure copy</p>

<ul>
<li><code>scp server:source/ dest/</code> - Copy from external server to local</li>
</ul></li>

<li><p>ssh - Secure Shell commands (more on how to setup <a href="https://github.com/lony/dotFiles/tree/master/.ssh">here</a>)</p>

<ul>
<li><code>ssh -vT git@github.com</code> <a href="http://stackoverflow.com/questions/2643502/git-permission-denied-publickey">1</a> - Testing GIT via SSH connection using verbose mode</li>
<li><code>ssh -L 27017:localhost:27017 ec2-FOO.eu-west-1.compute.amazonaws.com</code> <a href="https://www.howtoforge.com/reverse-ssh-tunneling">1</a> - Tunnel Mongo port from local machine to ec2 machine using SSH</li>
<li><code>ssh -i ${SSH_KEY} -L ${PORT}:${TARGET_HOST}:${PORT} ec2-user@${BASTION_HOST} -N</code> - Tunnel port using a bastian host</li>
</ul></li>

<li><p>tcpdump <a href="http://packetpushers.net/masterclass-tcpdump-interpreting-output/">1</a> - Packet analyzer</p>

<ul>
<li><p><code>tcpdump -nvvvp -i any -c 100 -s 1500 -w /tmp/capture.file.pcap</code> <a href="http://bencane.com/2014/10/13/quick-and-practical-reference-for-tcpdump/">1</a> - Write first 1500 bytes of the first 100 packages to PCAP file which are coming from any device</p>

<ul>
<li><code>-n</code> - Do not translate hostnames (use ips)</li>
<li><code>-v</code> - Verbosity (max. vvv)</li>
<li><code>-p</code> - Don&rsquo;t put the interface into promiscuous mode</li>
<li><code>-i</code> - Interface to use (any for all)</li>
<li><code>-c</code> - Exit after amount of packets</li>
<li><code>-s</code> - Truncates bytes of data for each package</li>
<li><code>-w</code> - Store PCAP file of dump</li>
</ul></li>

<li><p><code>tcpdump -A 'port 80 and host 192.168.0.1'</code> <a href="https://danielmiessler.com/study/tcpdump/">1</a> - Print package output in ANSII format</p></li>

<li><p><code>tcpdump host 10.0.3.1</code> - Capture only if source and destination ip is 10.0.3.1</p></li>

<li><p><code>tcpdump src host 10.0.3.1</code> - Capture only if source ip is 10.0.3.1</p></li>

<li><p><code>tcpdump dst port 80</code> - Caputre only if destination port is 80</p></li>

<li><p><code>tcpdump (src net 10.0.0.144/28) and not(dst host 10.20.0.251)</code> <a href="http://serverfault.com/questions/354102/tcpdump-filter-on-network-and-subnet-mask">1</a>  - Captue only traffic which is from specific network and not going to a specific host</p>

<ul>
<li>Hint: Use lowest IP for range to avoid <code>tcpdump: non-network bits set in “10.0.0.145/28&quot;</code> error <a href="http://stackoverflow.com/questions/10300656/capture-incoming-traffic-in-tcpdump">1</a></li>
</ul></li>

<li><p><code>tcpdump 'tcp[tcpflags] &amp; tcp-syn != 0'</code> <a href="http://www.tcpdump.org/manpages/pcap-filter.7.html">1</a>, <a href="https://syedali.net/2014/12/29/tcp-flags-explained/">2</a>, <a href="https://danielmiessler.com/study/tcpflags/">3</a> - Use PCAP-filters to capture start (SYN) packets of TCP conversation</p></li>

<li><p><code>tcpdump 'tcp[tcpflags] &amp; (tcp-syn) != 0 and tcp[tcpflags] &amp; (tcp-ack) == 0 or udp'</code> - Capture tcp SYN but not SYN-ACK and also udp packets</p></li>
</ul></li>

<li><p>trace aka traceroute <a href="https://en.wikipedia.org/wiki/Traceroute">1</a> - Display route for transit of packets across IP network</p></li>

<li><p>vnstat <a href="https://wiki.ubuntuusers.de/vnStat/">1</a>,<a href="http://www.thegeekstuff.com/2011/11/vnstat-network-traffic-monitor/">2</a> - Network traffic monitor</p></li>
</ul>

<h1 id="searching">Searching</h1>

<ul>
<li><p>find</p>

<ul>
<li><code>find / -type d -name &quot;lony.github.io&quot;</code> - Search for lony&hellip; folder in root</li>
<li><code>find download/ -mtime +60  -delete</code> - Search in download-folder for files last modified before +60 and delete</li>
<li><code>find /path/to/directory/ -mindepth 1 -mtime +365 -type f -name &quot;*.tmp&quot; -print</code> <a href="http://unix.stackexchange.com/questions/194863/delete-files-older-than-x-days">1</a>, <a href="http://askubuntu.com/questions/413529/delete-files-older-than-one-year-on-linux">2</a>, <a href="http://stackoverflow.com/questions/5927369/recursively-look-for-files-with-a-specific-extension">3</a>
then <code>find /path/to/directory/ -mindepth 1 -mtime +365 -type f -name &quot;*.tmp&quot; -delete</code></li>
<li><code>find /path/to/directory/ -mindepth 1 -maxdepth 1 -mtime +365 -type d -print -exec rm -r &quot;{}&quot; \;</code> - <a href="http://unix.stackexchange.com/questions/89925/how-to-delete-directories-based-on-find-output">1</a>, <a href="http://askubuntu.com/questions/377438/how-can-i-recursively-delete-all-files-of-a-specific-extension-in-the-current-di">2</a> Delete directories recursivly</li>
</ul></li>

<li><p>grep <a href="https://www.cyberciti.biz/faq/grep-regular-expressions/">1</a></p>

<ul>
<li><code>grep foo /home/lony/bar</code> - Search for foo in bar</li>
<li><code>grep -r foo /home/lony/bar</code> - Search recursively for foo in bar</li>
<li><code>grep -nr 'foo*' .</code> <a href="http://stackoverflow.com/questions/4121803/how-can-i-use-grep-to-find-a-word-inside-a-folder">1</a> - Search for foo* in <code>.</code> showing relative line number</li>
<li><code>zgrep foo /home/lony/log.1.gz | less</code> - Search inside gzip log file for foo</li>
</ul></li>
</ul>

<h1 id="documentation">Documentation</h1>

<h1 id="miscellaneous">Miscellaneous</h1>

<ul>
<li><p>watch <a href="https://en.wikipedia.org/w/index.php?oldid=725168377">1</a></p>

<ul>
<li><p><code>watch -d=cumulative -n 5 'ls -lah | grep data.pcap'</code> <a href="http://askubuntu.com/questions/430382/repeat-a-command-every-x-interval-of-time-in-terminal">1</a> - Runs ls every 5s and highlighting changes</p>

<ul>
<li><code>-d=cumulative</code> - Highlight differences that ever changed since start</li>
<li><code>-n &lt;SECONDS&gt;</code> - Run every X seconds (default=2s)</li>
</ul></li>
</ul></li>
</ul>

<h2 id="programming-sh">Programming sh</h2>

<h3 id="array">array</h3>

<ul>
<li><p>Concat array <a href="http://stackoverflow.com/questions/9522631/how-to-put-line-comment-for-a-multi-line-command">1</a>, <a href="http://stackoverflow.com/questions/18599711/how-can-i-split-a-shell-command-over-multiple-lines-when-using-an-if-statement">2</a></p>

<pre><code>brew_packages=(
    ansible     # Comment1
    go      # Comment2
)

brew install &quot;${brew_packages[@]}&quot;
</code></pre></li>
</ul>

<h3 id="for">for</h3>

<ul>
<li><code>for i in &quot;ci&quot; &quot;stage&quot; &quot;prod&quot;; do (export ENVI=$i; echo $ENVI); done</code> <a href="http://stackoverflow.com/questions/8880603/loop-through-array-of-strings-in-bash">1</a>,<a href="https://www.cyberciti.biz/faq/linux-unix-bash-for-loop-one-line-command/">2</a>,<a href="http://stackoverflow.com/questions/10856129/setting-an-environment-variable-before-a-command-in-bash-not-working-for-second">3</a></li>
</ul>

<h3 id="if">if</h3>

<ul>
<li><p>Bash version =&gt; 4 <a href="http://unix.stackexchange.com/questions/250778/should-i-check-bash-version">1</a></p>

<pre><code>if [[ ${BASH_VERSION%%.*} -lt 4 ]]; then
echo &quot;This script requires bash version &gt; 4. Currently running is ${BASH_VERSION%%.*}&quot;
exit 1
fi
</code></pre></li>
</ul>

<h3 id="until">until</h3>

<ul>
<li><code>until ssh aws-host; do echo &quot;Try again&quot;; sleep 2; done</code></li>
</ul>

<h3 id="pasting">pasting</h3>

<pre><code># With parameter expanding
cat &lt;&lt;EOF &gt;&gt; bash-paste_expanding
export ME=`whoami`
EOF
## Result: export ME=lony
</code></pre>

<pre><code># Without parameter expanding (look at the ')
cat &lt;&lt;'EOF' &gt;&gt; bash-paste_not-expanding
export ME=`whoami`
EOF
## Result: export ME=`whoami`
</code></pre>

<h3 id="pipe">pipe</h3>

<ul>
<li><code>&gt; FILE</code> same as <code>1&gt; FILE</code> - Pipe standard out (stdout) into file and overwrites content</li>
<li><code>2&gt; FILE</code> <a href="http://stackoverflow.com/questions/818255/in-the-shell-what-does-21-mean">1</a> - Pipe errors (stderr) into file and overwrites content</li>
<li><code>2&gt;&amp;1 &gt;&gt; FILE</code> <a href="http://serverfault.com/questions/196734/bash-difference-between-and-operator">1</a> - Pipe errors (stderr) and standard out (stdout) into file and append content</li>
</ul>

<h3 id="read">read</h3>

<ul>
<li><code>read -p &quot;Enter username to check:&quot; USERNAME &amp;&amp; echo $USERNAME</code></li>
</ul>

<h2 id="setup">Setup</h2>

<h3 id="prompt">Prompt</h3>

<pre><code>ERRORLEVEL TIME USER@HOST PATH #
2 [14:03:07] lony@hobbes /var/log/upstart # echo $PS1
$? \[\e[01;34m\][$(date &quot;+%H:%M:%S&quot;)] \[\e[01;31m\]\u\[\e[1;34m\]@\[\e[1;31m\]\h\[\e[1;34m\] \w # \[\e[0m\]
</code></pre>

<h3 id="distribution">Distribution</h3>

<ul>
<li><code>uname -a</code> - Show kernel version and private system information</li>
</ul>

<h4 id="ubuntu">Ubuntu</h4>

<ul>
<li><code>lsb_release -a</code> - Print version</li>
</ul>

<h1 id="meta">Meta</h1>

<ul>
<li>How to structure this document? <strong>Answer</strong>: as the UNIX wikipedia

<ul>
<li><a href="https://en.wikipedia.org/wiki/List_of_Unix_commands">article</a></li>
<li><a href="https://en.wikipedia.org/wiki/Book:Unix_Commands">book</a></li>
</ul></li>
</ul>

<hr />

<p>Now that you read that far - thank you and please remember, if you find a bug or want to recommend something, please feel free to open an <a href="https://github.com/lony/lony.github.io/issues">issue</a> and help me get better!</p>

    </div>
  </div>
</section>


<section class="section">
  <div class="container has-text-centered">
    <p>&copy; <a href="https://github.com/lony">Goetz Epperlein</a> 2016</p>
  </div>
</section>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/highlight.min.js" integrity="sha256-KbfTjB0WZ8vvXngdpJGY3Yp3xKk+tttbqClO11anCIU=" crossorigin="anonymous"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/go.min.js"></script>

<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.9.0/languages/dockerfile.min.js"></script>

<script>hljs.initHighlightingOnLoad();</script>


<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-83817537-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>



